<div *ngIf="loading">
  <mat-progress-spinner
    mode="indeterminate"
    [value]="100"
    color="primary"
    class="loading-spinner"
  ></mat-progress-spinner>
</div>
<p class="text-errorr bold">{{ errorMessage }}</p>
<div
  *ngIf="!loading"
  fxLayout="column"
  fxFlex="86"
  [ngStyle]="{ margin: '20px auto' }"
  fxFlex.xs="100"
  [ngStyle.xs]="{ margin: '20px auto' }"
>
  <header>
    <h1 fxHide.xs class="bold">{{ fundraiser?.title }}</h1>
  </header>
  <div fxLayout="row" fxLayoutAlign="space-around start" fxFlex.md="98">
    <div
      fxLayout="column"
      fxLayoutGap="20px"
      fxLayoutAlign="start end"
      fxFlex="66"
      [ngStyle]="{ 'padding-right': '20px' }"
      fxFlex.lt-md="100"
    >
      <div>
        <img
          class="fundraiser-img"
          [src]="fundraiser?.image"
          alt="fundraiser image"
        />
      </div>

      <div fxHide.md fxLayout.xs="column">
        <h1 class="bold">{{ fundraiser?.title }}</h1>
        <div
          fxLayout="row"
          fxLayoutAlign="start center"
          fxLayoutGap="2px"
          style="margin-bottom: -15px"
        >
          <h2>
            <span class="bold">{{ fundraiser?.totalRaised | currency }} </span>
            <sub class="text-small color-gray"
              >raised of {{ fundraiser?.goalAmount | currency }}goal</sub
            >
          </h2>
        </div>
        <mat-progress-bar color="primary" value="percentage">
        </mat-progress-bar>
        <div fxLayout="row" fxLayoutGap="30px" style="margin: 10px 0px">
          <a fxLayout="column" (click)="allDonations()">
            <span class="bold">{{ fundraiser?.donations?.length }}k</span
            ><mat-hint>donors</mat-hint>
          </a>

          <span fxLayout="column">
            <span class="bold">{{ fundraiser?.totalShareCount }}k</span>
            <mat-hint>shares</mat-hint>
          </span>
          <span fxLayout="column">
            <span class="bold">{{ fundraiser?.likeCount }}k</span>
            <mat-hint>followers</mat-hint>
          </span>
        </div>
        <div
          fxLayout="row wrap"
          fxLayoutAlign="space-between center"
          style="position: sticky; top: 0"
        >
          <button
            fxFlex="40"
            mat-raised-button
            (click)="share()"
            class="styled-button share btn-small"
          >
            <mat-icon>ios_share</mat-icon> Share
          </button>
          <button
            fxFlex="40"
            mat-raised-button
            [routerLink]="['/donate', fundraiser?._id]"
            class="styled-button donate btn-small"
          >
            <mat-icon>attach_money</mat-icon> Donate now
          </button>
        </div>
      </div>

      <!-- Fundraiser info -->
      <div
        fxLayout="column"
        fxLayoutAlign="space-around start"
        fxLayoutGap="20px"
        fxFlex="90"
        fxFlex.lt-md="98"
      >
        <div>
          <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
            <!-- organiser image or icon -->
            <img matCardAvatar src="/assets/images/step2.jpg" />
            <!-- <mat-icon color="primary"> volunteer_activism </mat-icon> -->
            <p>
              {{ fundraiser?.organizer?.firstName | titlecase }}
              {{ fundraiser?.organizer?.lastName | titlecase }} is organizing
              this fundraiser
            </p>
          </div>
          <mat-divider></mat-divider>
        </div>
        <div>
          <p>
            {{ fundraiser?.dateCreated | timeago }} |
            <a href="">{{ fundraiser?.category?.name }}</a>
          </p>
          <mat-divider></mat-divider>
        </div>

        <!-- story section -->
        <section>
          <div [innerHTML]="fundraiser?.story"></div>
        </section>

        <div *ngIf="true" fxLayout="column" fxLayoutGap="10px" fxHide.md>
          <div></div>
          <div
            fxLayout="row"
            fxLayoutAlign="start center"
            fxLayoutGap="20px"
            class="color-purple"
          >
            <mat-icon class="mat-18 bg-purple-avatar">trending_up</mat-icon>
            <strong
              >{{ fundraiser?.donations?.length }} people just donated</strong
            >
          </div>

          <div>
            <mat-divider> </mat-divider>
          </div>

          <div fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutGap="20px">
              <img
                src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
              />
              <div fxLayout="column">
                <span>Recent Donor</span>
                <div fxLayout="row" fxLayoutGap="20px">
                  <strong>$25</strong>
                  <a href="">Recent donation </a>
                </div>
              </div>
            </div>
            <mat-divider> </mat-divider>
          </div>
          <div fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutGap="20px">
              <img
                src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
              />
              <div fxLayout="column">
                <span>Top Donor</span>
                <div fxLayout="row" fxLayoutGap="20px">
                  <strong>$25</strong>
                  <a href="">Top donation </a>
                </div>
              </div>
            </div>
            <mat-divider> </mat-divider>
          </div>
          <div fxLayout="row" fxLayoutGap="20px">
            <img
              src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
            />
            <div fxLayout="column">
              <span>First Donor</span>
              <div fxLayout="row" fxLayoutGap="20px">
                <strong>$25</strong>
                <a href="">First donation </a>
              </div>
            </div>
          </div>

          <div fxLayout="row wrap" fxLayoutAlign="space-between start">
            <button mat-raised-button (click)="allDonations()" color="primary">
              See all
            </button>
            <button mat-stroked-button (click)="topDonations()" color="primary">
              <mat-icon class="mat-18"> favorite_border </mat-icon>
              See top donations
            </button>
          </div>
        </div>

        <div>
          <div>
            <h2 class="bold">Updates({{ fundraiser?.updates?.length }})</h2>
            <mat-divider></mat-divider>
          </div>
          <div *ngFor="let update of fundraiser?.updates; let last = last">
            <p>
              <Strong>{{ update.dateCreated | timeago }}</Strong>
              <span class="text-small color-gray">
                by {{ update.userId?.firstName | titlecase }}
                {{ update.userId?.lastName | titlecase }}, Organizer</span
              >
            </p>
            <p>{{ update.content }}</p>
            <div *ngIf="!last">
              <mat-divider></mat-divider>
            </div>
          </div>

          <!-- TODO -->
          <a href="">See older updates</a>
        </div>
        <div
          fxLayout="row wrap"
          fxLayoutAlign="space-between center"
          style="position: sticky; top: 0"
        >
          <button
            fxFlex="40"
            mat-raised-button
            (click)="share()"
            class="styled-button share btn-small"
          >
            <mat-icon>ios_share</mat-icon> Share
          </button>
          <button
            fxFlex="40"
            mat-raised-button
            [routerLink]="['/donate', fundraiser?._id]"
            class="styled-button donate btn-small"
          >
            <mat-icon>attach_money</mat-icon> Donate now
          </button>
        </div>

        <!-- Fudrising team section -->
        <div fxLayout="column" fxLayoutGap="20px">
          <div>
            <h2 class="bold">
              Fundrising team: Team
              {{ fundraiser?.organizer?.firstName | titlecase }}({{
                1 + fundraiser!.teams!.length
              }})
            </h2>
            <div>
              <mat-divider></mat-divider>
            </div>
          </div>
          <div fxLayout="row wrap" fxLayoutAlign="space-around center">
            <div
              fxLayout="row"
              fxLayoutAlign="start start"
              fxLayoutGap="20px"
              style="width: fit-content"
            >
              <img matCardAvatar src="/assets/images/step2.jpg" />
              <div fxLayout="column" style="width: fit-content">
                <span class="bold">
                  {{ fundraiser?.organizer?.firstName | titlecase }}
                  {{ fundraiser?.organizer?.lastName | titlecase }}</span
                >
                <span>Organizer</span>

                <!-- TODO adress of the organiser -->
                <span>Atlanta, GA</span>
              </div>
            </div>
          </div>
          <div>
            <mat-divider></mat-divider>
          </div>

          <div
            fxLayout="row wrap"
            fxLayoutAlign="start center"
            fxLayoutGap="30px"
          >
            <div fxFlex="25" *ngFor="let member of fundraiser?.teams">
              <div fxLayout="row" fxLayoutGap="20px" style="margin: 20px 0px">
                <img
                  src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
                />
                <div fxLayout="column">
                  <span class="bold"
                    >{{ member.userId.firstName | titlecase }}
                    {{ member.userId.lastName | titlecase }}
                  </span>
                  <span class="text-small">team member</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- end of fundrising team section -->

        <!-- Organiser and beneficiary section -->
        <!-- this will be shown if there is no fundrising team -->
        <div>
          <div>
            <h2 class="bold">Organizer and beneficiary</h2>
            <mat-divider> </mat-divider>
          </div>
          <div
            fxLayout="row"
            fxLayout.xs="column"
            fxLayoutAlign="space-between start"
            fxLayoutAlign.xs="space-between center"
            style="margin: 20px 0px"
          >
            <div
              fxLayout="row"
              fxLayoutAlign="start start"
              fxLayoutGap="20px"
              style="width: fit-content"
            >
              <img matCardAvatar src="/assets/images/step2.jpg" />
              <div fxLayout="column" style="width: fit-content">
                <span
                  >{{ fundraiser?.organizer?.firstName | titlecase }}
                  {{ fundraiser?.organizer?.lastName | titlecase }}</span
                >
                <span>Organizer</span>
                <span>Atlanta, GA</span>
              </div>
            </div>
            <mat-icon fxHide.xs> arrow_forward </mat-icon>
            <!-- <mat-icon fxShow.xs> arrow_downward </mat-icon> -->
            <div
              fxLayout="row"
              fxLayoutAlign="start start"
              fxLayoutGap="20px"
              style="width: fit-content"
            >
              <mat-icon color="primary">volunteer_activism</mat-icon>
              <div fxLayout="column">
                <span
                  >{{ fundraiser?.beneficiary?.firstName | titlecase }}
                  {{ fundraiser?.beneficiary?.lastName | titlecase }}</span
                >
                <span>Beneficiary</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- end of organizer and beneficiary -->

      <!-- Comment section -->
      <div>
        <h2 class="bold">Comments({{ fundraiser?.donations?.length }})</h2>
        <div>
          <mat-divider></mat-divider>
        </div>
        <div *ngFor="let donation of fundraiser?.donations; let last = last">
          <div
            fxLayout="row"
            fxLayoutAlign="start start"
            fxLayoutGap="20px"
            style="margin: 20px 0px"
          >
            <img
              src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
            />
            <div fxLayout="column">
              <span class="bold"
                >{{ donation.userId.firstName | titlecase }}
                {{ donation.userId.lastName | titlecase }} donated
                <strong>${{ donation.amount }}</strong></span
              >
              <p>{{ donation.comment }} <a>Read more</a></p>
            </div>
          </div>
          <!-- <button
            *ngIf="last"
            mat-stroked-button
            color="primary"
            class="btn-outline"
          >
            Show more
          </button> -->
          <div>
            <mat-divider></mat-divider>
          </div>
        </div>
      </div>
      <!--End of Comment section -->
    </div>

    <!-- Card on the right side -->

    <mat-card fxHide.lt-md>
      <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="8px">
        <div>
          <div
            fxLayout="row"
            fxLayoutAlign="start center"
            fxLayoutGap="2px"
            style="margin-bottom: -15px"
          >
            <h2>
              <span class="bold"
                >{{ fundraiser?.totalRaised | currency }}
              </span>
              <sub class="text-small color-gray"
                >raised of {{ fundraiser?.goalAmount | currency }} goal</sub
              >
            </h2>
          </div>
          <mat-progress-bar color="primary" [value]="percentage">
          </mat-progress-bar>
          <div fxLayout="row" fxLayoutGap="30px" style="margin: 10px 0px">
            <a fxLayout="column" href="">
              <span class="bold">{{ fundraiser?.donations?.length }}</span
              ><mat-hint>donors</mat-hint>
            </a>

            <div fxLayout="column">
              <span class="bold">{{ fundraiser?.totalShareCount }}</span>
              <mat-hint>shares</mat-hint>
            </div>
            <div fxLayout="column">
              <span class="bold">{{ fundraiser?.likeCount }}</span>
              <mat-hint>followers</mat-hint>
            </div>
          </div>
        </div>
        <button
          mat-raised-button
          (click)="share()"
          class="styled-button share btn-large"
        >
          <mat-icon>ios_share</mat-icon> Share
        </button>
        <button
          mat-raised-button
          [routerLink]="['/donate', fundraiser?._id]"
          class="styled-button donate btn-large"
        >
          <mat-icon>attach_money</mat-icon> Donate now
        </button>

        <!-- Show this div if donations have made to this fundraiser -->
        <div
          *ngIf="fundraiser?.donations?.length !== 0"
          fxLayout="column"
          fxLayoutGap="20px"
        >
          <div></div>
          <div fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutGap="20px">
              <mat-icon class="mat-18 bg-purple-avatar">trending_up</mat-icon>
              <strong
                >{{ fundraiser?.donations?.length }} people just donated</strong
              >
            </div>
            <div>
              <mat-divider> </mat-divider>
            </div>
          </div>
          <div fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutGap="20px">
              <img
                src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
              />
              <div fxLayout="column">
                <div
                  fxLayout="row wrap"
                  fxLayoutAlign="space-between start"
                  fxLayoutGap="30px"
                >
                  <span
                    >{{ recentDonation?.userId?.firstName | titlecase }}
                    {{ recentDonation?.userId?.lastName | titlecase }}</span
                  >
                  <span class="text-small color-gray">
                    {{ recentDonation?.date | timeago }}
                  </span>
                </div>
                <div fxLayout="row wrap" fxLayoutGap="20px">
                  <strong>{{ recentDonation?.amount | currency }}</strong>
                  <a>Recent donation </a>
                </div>
              </div>
            </div>
            <div>
              <mat-divider> </mat-divider>
            </div>
          </div>
          <div fxLayout="column" fxLayoutGap="10px">
            <div fxLayout="row" fxLayoutGap="20px">
              <img
                src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
              />
              <div fxLayout="column">
                <div
                  fxLayout="row wrap"
                  fxLayoutAlign="space-between start"
                  fxLayoutGap="30px"
                >
                  <span
                    >{{ topDonation?.userId?.firstName | titlecase }}
                    {{ topDonation?.userId?.lastName | titlecase }}</span
                  >
                  <span class="text-small color-gray">
                    {{ topDonation?.date | timeago }}
                  </span>
                </div>
                <div fxLayout="row wrap" fxLayoutGap="20px">
                  <strong>{{ topDonation?.amount | currency }}</strong>
                  <a href="">Top donation </a>
                </div>
              </div>
            </div>
            <div>
              <mat-divider> </mat-divider>
            </div>
          </div>
          <fxLayout fxLayout="row" fxLayoutGap="20px">
            <img
              src="https://www.gofundme.com/static/media/DefaultAvatar.4bb188e1d41df75419450a820a958679.svg"
            />
            <div fxLayout="column">
              <div
                fxLayout="row wrap"
                fxLayoutAlign="space-between start"
                fxLayoutGap="30px"
              >
                <span
                  >{{ firstDonation?.userId?.firstName | titlecase }}
                  {{ firstDonation?.userId?.lastName | titlecase }}</span
                >
                <span class="text-small color-gray">
                  {{ firstDonation?.date | timeago }}
                </span>
              </div>
              <div fxLayout="row wrap" fxLayoutGap="20px">
                <strong>{{ firstDonation?.amount | currency }}</strong>
                <a href="">First donation </a>
              </div>
            </div>
          </fxLayout>
          <div fxLayout="row wrap" fxLayoutAlign="space-between start">
            <button mat-raised-button (click)="allDonations()" color="primary">
              See all
            </button>
            <button mat-stroked-button (click)="topDonations()" color="primary">
              <mat-icon class="mat-18"> favorite_border </mat-icon>
              See top donations
            </button>
          </div>
        </div>

        <!-- Show this div on if no donations have made to this fundraiser yet -->
        <div *ngIf="fundraiser?.donations?.length === 0">
          <div fxLayout="row" fxLayoutGap="20px">
            <mat-icon color="primary"> volunteer_activism </mat-icon>
            <p>Become the first supporter Your donation matters</p>
          </div>
          <p></p>
          <p><mat-divider></mat-divider></p>
          <p></p>

          <h3 class="bold">GoFundMe Guarantee</h3>
          <p style="text-align: justify">
            In the rare case something isn’t right, we will work with you to
            determine if misuse occurred.
          </p>
        </div>
      </div>
    </mat-card>
  </div>
</div>
