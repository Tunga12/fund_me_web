<nav class="mat-elevation-z2">
  <nav-bar></nav-bar>
</nav>
<div *ngIf="loading">
  <mat-progress-spinner
    mode="indeterminate"
    [value]="100"
    color="primary"
    class="loading-spinner"
  >
  </mat-progress-spinner>
</div>

  <mat-error fxAlign="center" *ngIf="errorMessage && !loading" fxFlexAlign="center">
    {{ errorMessage }}
  </mat-error>
<div
  *ngIf="fundraiser"
  fxLayout="column"
  fxLayoutAlign="start center"
  fxLayoutGap="30px"
  style="width: 80%; margin: 30px auto"
  [ngStyle.lt-md]="{ width: '96%', margin: '30px auto' }"
>
  <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="20px">
    <button
      mat-button
      routerLink="/my-fundraisers"
      class="bold"
      style="margin: 20px 0px"
    >
      <mat-icon class="mat-18"> arrow_back_ios </mat-icon>
      <span fxHide.lt-sm> {{"Back"| translate}} </span>
    </button>
    <div fxLayout="row" fxLayoutAlign="space-between start">
      <div
        fxLayout="row"
        fxLayout.lt-sm="column"
        fxLayoutAlign="space-between center"
        fxLayoutGap="20px"
        fxFlex="60"
        fxFlex.sm="80"
        fxFlex.lt-sm="100"
      >
        <img
          [src]="fundraiser.image"
          onerror="this.src='/assets/images/placeholder.png'"
          height="126px"
          width="176px"
          [ngStyle.lt-sm]="{ width: '100%', margin: 'auto' }"
        />
        <div
          fxLayout="column"
          fxLayoutAlign="start start"
          fxLayoutGap="10px"
          fxFlex.xs="100"
        >
          <h2 class="bold">{{ fundraiser.title }}</h2>
          <div fxLayout="row" fxLayoutAlign="start start" fxLayoutGap="10px">
            <a
              *ngIf="isOrganizer()"
              fxLayout="row"
              fxLayoutAlign="start center"
              [routerLink]="['/edit', fundraiser._id]"
            >
              <mat-icon> edit </mat-icon> <span>{{"Edit & Settings"| translate}}</span>
            </a>
            <a
              fxLayout="row"
              fxLayoutAlign="start center"
              [routerLink]="['/fundraiser-detail', fundraiser._id]"
            >
              <mat-icon>visibility </mat-icon> <span>{{"View fundraiser"| translate}}</span>
            </a>
          </div>
          <mat-progress-bar
            mode="determinate"
            [value]="getPercentage(fundraiser)"
            color="primary"
          ></mat-progress-bar>
          <p>{{"Total raised:"| translate }} {{ getTotalRaised(fundraiser)| currency:"ETB" }}</p>
        </div>
      </div>

      <div
        fxLayout="row"
        fxHide.lt-md
        fxLayoutAlign="end center"
        fxLayoutGap="20px"
        fxFlex="40"
      >
        <a
          (click)="openShareDialog()"
          fxLayout="column"
          fxLayoutAlign="center center"
          fxLayoutGap="10px"
        >
          <div class="bg-green-avatar">
            <mat-icon> ios_share </mat-icon>
          </div>
          <span class="text-md">{{"Share"| translate}}</span>
        </a>
        <a
          (click)="openUpdateDialog()"
          fxLayout="column"
          fxLayoutAlign="start center"
          fxLayoutGap="10px"
        >
          <div class="green-outline-avatar">
            <mat-icon> update </mat-icon>
          </div>
          <span class="text-md">{{"Update"| translate}}</span>
        </a>
        <a
          *ngIf="isOrganizer() || isBeneficiary()"
          (click)="withdrawal(fundraiser?._id!)"
          fxLayout="column"
          fxLayoutAlign="start center"
          fxLayoutGap="10px"
        >
          <div class="green-outline-avatar">
            <mat-icon> account_balance </mat-icon>
          </div>
          <span class="text-md">{{"Withdraw"| translate }}</span>
        </a>
      </div>
    </div>
  </div>

  <div>
    <mat-divider></mat-divider>
  </div>

  <!-- Share on facebook banner -->
  <banner (share)="openShareDialog()" [ngStyle]="{'padding': '20px'}"></banner>

  <!-- main area -->
  <mat-tab-group mat-align-tabs="start" [disableRipple]="false">
    <mat-tab
      label="{{ index === 0 ? ('Donors'|translate) : index === 1 ? ('Team'|translate) : 'Updates' | translate}}"
      *ngFor="let tab of tabs; let index = index"
    >
      <div *ngIf="index === 0">
        <app-donors-tab-content
          [fundraiser]="fundraiser"
        ></app-donors-tab-content>
      </div>
      <!-- Team tab -->
      <div *ngIf="index === 1">
        <team-tab-content [fundraiser]="fundraiser"></team-tab-content>
      </div>
      <!-- Updates tab -->
      <div class="tab-content" *ngIf="index === 2">
        <updates-tab-content
          [fundraiser]="fundraiser"
          (update)="openUpdateDialog()"
        ></updates-tab-content>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
